<!DOCTYPE html>
<html>
<head>
    <title>Test de Connexion Hardhat</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.6.9.umd.min.js"></script>
</head>
<body>
    <h1>Test de Connexion au Réseau Hardhat</h1>
    <div id="status"></div>
    <button onclick="testConnection()">Tester la Connexion</button>

    <script>
        async function testConnection() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Test en cours...';

            try {
                // Test 1: Connexion directe au provider
                const provider = new ethers.providers.JsonRpcProvider('http://127.0.0.1:8545');
                const network = await provider.getNetwork();
                statusDiv.innerHTML += `<br>✅ Réseau connecté: ${network.name} (ChainId: ${network.chainId})`;

                // Test 2: Vérifier les comptes disponibles
                const accounts = await provider.listAccounts();
                statusDiv.innerHTML += `<br>✅ Comptes disponibles: ${accounts.length}`;
                statusDiv.innerHTML += `<br>Premier compte: ${accounts[0]}`;

                // Test 3: Vérifier le solde
                const balance = await provider.getBalance(accounts[0]);
                statusDiv.innerHTML += `<br>✅ Solde: ${ethers.utils.formatEther(balance)} ETH`;

                // Test 4: Tester MetaMask si disponible
                if (typeof window.ethereum !== 'undefined') {
                    statusDiv.innerHTML += `<br>✅ MetaMask détecté`;

                    try {
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const metamaskProvider = new ethers.providers.Web3Provider(window.ethereum);
                        const metamaskNetwork = await metamaskProvider.getNetwork();
                        statusDiv.innerHTML += `<br>✅ MetaMask réseau: ${metamaskNetwork.name} (ChainId: ${metamaskNetwork.chainId})`;

                        if (metamaskNetwork.chainId !== 1337) {
                            statusDiv.innerHTML += `<br>⚠️ MetaMask n'est PAS sur le bon réseau! Devrait être 1337`;
                        }
                    } catch (metamaskError) {
                        statusDiv.innerHTML += `<br>❌ Erreur MetaMask: ${metamaskError.message}`;
                    }
                } else {
                    statusDiv.innerHTML += `<br>❌ MetaMask non détecté`;
                }

            } catch (error) {
                statusDiv.innerHTML += `<br>❌ Erreur: ${error.message}`;
            }
        }

        // Test automatique au chargement
        window.onload = testConnection;
    </script>
</body>
</html>
